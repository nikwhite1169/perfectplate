<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Account - PerfectPlate</title>

  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" type="image/x-icon" />

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="header-top">
      <img src="images/logo.png" alt="PerfectPlate Logo" class="logo" />
      <h1>Manage Your Account</h1>
    </div>
  </header>

  <main>
    <div class="account-settings-box">
      <!-- Account Settings Section -->
      <section id="account-management">
        <h2>Your Account Settings</h2>
      
        <!-- Update Email Form -->
        <form id="email-form">
          <div class="form-group">
            <label for="email">Update Email Address:</label>
            <input type="email" id="email" placeholder="Enter new email" required />
          </div>
          <button type="submit" class="cta-button">Update Email</button>
        </form>
      
        <!-- Update Password Form -->
        <form id="password-form">
          <div class="form-group password-group">
            <label for="password">Change Password:</label>
            <div class="password-wrapper">
              <input type="password" id="password" placeholder="Enter new password" />
              <span class="toggle-password">üëÅ</span>
            </div>
            <span id="password-error" class="error-message"></span>
          </div>
      
          <div class="form-group password-group">
            <label for="confirm-password">Confirm New Password:</label>
            <div class="password-wrapper">
              <input type="password" id="confirm-password" placeholder="Confirm new password" />
              <span class="toggle-password">üëÅ</span>
            </div>
            <span id="confirm-password-error" class="error-message"></span>
          </div>
      
          <button type="submit" class="cta-button">Update Password</button>
        </form>
      </section>
          </div>

    <div class="account-settings-box">
      <!-- Payment and Billing Section -->
      <section id="payment-settings">
        <h3>Payment Settings</h3>
        <form id="payment-form">
          <div class="form-group">
            <label for="card-name">Name on Card:</label>
            <input type="text" id="card-name" placeholder="Enter name as it appears on card" required />
            <span id="card-name-error" class="error-message"></span>
          </div>
      
          <div class="form-group">
            <label for="card-number">Card Number:</label>
            <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19" required />
            <span id="card-number-error" class="error-message"></span>
          </div>
      
          <div class="form-group">
            <label for="expiry-date">Expiry Date (MM/YY):</label>
            <input type="text" id="expiry-date" placeholder="MM/YY" maxlength="5" required />
            <span id="expiry-date-error" class="error-message"></span>
          </div>
      
          <div class="form-group">
            <label for="cvc">CVC:</label>
            <input type="text" id="cvc" placeholder="123" maxlength="4" required />
            <span id="cvc-error" class="error-message"></span>
          </div>
      
          <button type="submit" class="cta-button">Update Payment</button>
        </form>
      </section>
            
      <section id="billing-history">
        <h3>Billing History</h3>
        <ul>
          <li>Invoice #12345 - $7.99 - January 2025</li>
          <li>Invoice #12344 - $7.99 - December 2024</li>
          <li>Invoice #12343 - $7.99 - November 2024</li>
        </ul>
      </section>
    </div>

    <div class="account-settings-box">
      <!-- Notification Preferences -->
      <section id="notification-preferences">
        <h3>Notification Preferences</h3>
        <form id="notification-form">
          <label>
            <input type="checkbox" id="email-notifications" checked />
            Receive email notifications
          </label>
          <label>
            <input type="checkbox" id="push-notifications" />
            Receive push notifications
          </label>
          <button type="submit" class="cta-button">Save Preferences</button>
        </form>
      </section>
    </div>

    <div class="account-settings-box">
        <!-- Cancel Subscription Section -->
        <section id="cancel-subscription-section">
          <h3>Cancel Subscription</h3>
          <button id="cancel-subscription" class="cta-button cancel-button">Cancel My Subscription</button>
        </section>
      </div>
      
      <!-- Cancel Subscription Confirmation Modal -->
      <div id="cancel-modal" class="modal hidden">
        <div class="modal-content">
          <h3>Are you sure you want to cancel your subscription?</h3>
          <p>
            By canceling, you‚Äôll lose access to personalized meal recommendations, exclusive features,
            and your PerfectPlate history.
          </p>
          <div class="modal-actions">
            <button id="confirm-cancel" class="danger-button">I'm Sure üò¢</button>
            <button id="close-modal" class="cta-button">Never Mind üéâ</button>
          </div>
          
        </div>
      </div>

      <!-- Cancellation Reason Modal -->
      <div id="cancel-reason-modal" class="modal hidden">
        <div class="modal-content">
          <span id="close-cancel-reason" class="close">&times;</span>
          <h2>We're sorry to see you go!</h2>
          <p>Please let us know why you are canceling:</p>
          <form id="cancel-reason-form">
            <textarea id="cancel-reason" name="cancel-reason" rows="4" cols="50" placeholder="Your reason for canceling..."></textarea>
            <button type="submit" class="cta-button">Submit</button>
          </form>
        </div>
      </div>
              </main>

  <footer>
    <p>&copy; 2025 PerfectPlate. Perfect dining, made just for you.</p>
    <a href="privacy-policy.html">Privacy Policy</a> |
    <a href="terms-of-service.html">Terms of Service</a> |
    <a href="faq.html">FAQ</a>
  </footer>

  <script>
// Email Update Submission
document.getElementById('email-form').addEventListener('submit', (event) => {
  event.preventDefault();

  const email = document.getElementById('email').value.trim();

  if (!/^\S+@\S+\.\S+$/.test(email)) {
    alert('Please enter a valid email address.');
    return;
  }

  alert(`Email updated successfully to ${email}!`);
});

// Password Toggle Visibility
document.querySelectorAll('.toggle-password').forEach((toggle) => {
  toggle.addEventListener('click', () => {
    const passwordInput = toggle.previousElementSibling;
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      toggle.textContent = 'üôà'; // Change icon
    } else {
      passwordInput.type = 'password';
      toggle.textContent = 'üëÅ'; // Change icon
    }
  });
});

// Validate Password Complexity
function validatePassword() {
  const password = document.getElementById('password').value;
  const passwordError = document.getElementById('password-error');
  const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#])[A-Za-z\d@$!%*?&#]{8,}$/;

  if (!passwordRegex.test(password)) {
    passwordError.textContent =
      'Password must be at least 8 characters, include uppercase, lowercase, a number, and a symbol.';
    return false;
  }
  passwordError.textContent = ''; // Clear the error
  return true;
}

// Validate Password Match
function validateConfirmPassword() {
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirm-password').value;
  const confirmPasswordError = document.getElementById('confirm-password-error');

  if (password !== confirmPassword) {
    confirmPasswordError.textContent = 'Passwords do not match.';
    return false;
  }
  confirmPasswordError.textContent = ''; // Clear the error
  return true;
}

// Password Update Submission
document.getElementById('password-form').addEventListener('submit', (event) => {
  event.preventDefault();

  const isPasswordValid = validatePassword();
  const isConfirmPasswordValid = validateConfirmPassword();

  if (isPasswordValid && isConfirmPasswordValid) {
    alert('Password updated successfully!');
  } else {
    alert('Please fix the errors before updating your password.');
  }
});

// Validate Credit Card Fields
function validateCardFields() {
  let isValid = true;

  // Validate Name on Card
  const cardName = document.getElementById('card-name').value.trim();
  const cardNameError = document.getElementById('card-name-error');
  if (cardName === '') {
    cardNameError.textContent = 'Name on card is required.';
    isValid = false;
  } else {
    cardNameError.textContent = '';
  }

  // Validate Card Number
  const cardNumber = document.getElementById('card-number').value.replace(/\s+/g, '');
  const cardNumberError = document.getElementById('card-number-error');
  if (!/^\d{16}$/.test(cardNumber)) {
    cardNumberError.textContent = 'Card number must be exactly 16 digits.';
    isValid = false;
  } else {
    cardNumberError.textContent = '';
  }

  // Validate Expiry Date
  const expiryDate = document.getElementById('expiry-date').value.trim();
  const expiryDateError = document.getElementById('expiry-date-error');
  if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(expiryDate)) {
    expiryDateError.textContent = 'Expiry date must be in MM/YY format.';
    isValid = false;
  } else {
    expiryDateError.textContent = '';
  }

  // Validate CVC
  const cvc = document.getElementById('cvc').value.trim();
  const cvcError = document.getElementById('cvc-error');
  if (!/^\d{3,4}$/.test(cvc)) {
    cvcError.textContent = 'CVC must be 3 or 4 digits.';
    isValid = false;
  } else {
    cvcError.textContent = '';
  }

  return isValid;
}

// Handle Payment Form Submission
document.getElementById('payment-form').addEventListener('submit', (event) => {
  event.preventDefault();

  if (validateCardFields()) {
    alert('Payment method updated successfully!');
  } else {
    alert('Please correct the errors before updating your payment method.');
  }
});

// Modal Elements
const cancelButton = document.getElementById('cancel-subscription');
const cancelModal = document.getElementById('cancel-modal');
const confirmCancelButton = document.getElementById('confirm-cancel');
const closeModalButton = document.getElementById('close-modal');
const cancelReasonModal = document.getElementById('cancel-reason-modal');
const closeCancelReasonButton = document.getElementById('close-cancel-reason');

// Show Modal on Cancel Button Click
cancelButton.addEventListener('click', () => {
  cancelModal.classList.remove('hidden');
});

// Close Modal on Never Mind Button Click
closeModalButton.addEventListener('click', () => {
  cancelModal.classList.add('hidden');
});

// Confirm Cancel Subscription
confirmCancelButton.addEventListener('click', () => {
  // Close the cancellation confirmation modal
  cancelModal.classList.add('hidden');

  // Open the reason modal
  cancelReasonModal.classList.remove('hidden');
});

closeCancelReasonButton.addEventListener('click', () => {
  cancelReasonModal.classList.add('hidden');
});

document.getElementById('cancel-reason-form').addEventListener('submit', function (event) {
  event.preventDefault();

  const reason = document.getElementById('cancel-reason').value;

  // Send the email using a backend service
  fetch('http://localhost:3000/send-email', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      to: 'perfectplateai@gmail.com',
      subject: 'Cancellation Reason',
      text: `Reason for cancellation: ${reason}`
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('Thank you for your feedback. Your response has been sent.');
    } else {
      alert('There was an error sending your response. Please try again later.');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('There was an error sending your response. Please try again later.');
  });

  // Close the reason modal
  cancelReasonModal.classList.add('hidden');
});
  </script>
</body>
</html>
